name: CodeQL Security Scan

description: Code QL Security Scan
  
runs:
  using: 'composite'
  steps:
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v2.21.5
      with:
        languages: csharp

    # this is needed to skip the build for the UI project
    - name: Create folder
      shell: bash
      run: |
          if [ -d "${{ github.workspace }}/WorkspaceForCodeQLAnalysis" ]  
          then
             rmdir ${{ github.workspace }}/WorkspaceForCodeQLAnalysis
          fi
          mkdir -p ${{ github.workspace }}/WorkspaceForCodeQLAnalysis
          for f in ${{ github.workspace }} 
          do
            if [ -d "$f" ] && [ basename $f != "WeatherForecastUI" ] && [ basename $f != "WorkspaceForCodeQLAnalysis" ] 
            then
                cp -a $f ${{ github.workspace }}/WorkspaceForCodeQLAnalysis
            fi
          done

    - name: Autobuild
      uses: github/codeql-action/autobuild@v2.21.5
      with:
       working-directory: ${{ github.workspace }}/WorkspaceForCodeQLAnalysis

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2.21.5